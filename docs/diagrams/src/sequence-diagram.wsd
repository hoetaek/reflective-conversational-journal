@startuml sequence-diagram
skinparam defaultTextAlignment center
skinparam dpi 300
skinparam ParticipantPadding 40
skinparam BoxPadding 20
hide footbox

title Journaling Process - Example Flow (journal.md)

actor User
participant "UI" as UI
box "Application Layer" #F0F0F0
    participant "Workflow" as Workflow
    participant "Persona" as Persona
    participant "Reflection" as Reflection
end box

box "Service Layer" #E8E8E8
    participant "Context" as Context
end box
database "Storage" as Storage

== Initialization ==
User -> UI : Start session
UI -> Workflow : Request
Workflow -> Context : Load context
Context -> Storage : Read profile & journals
Storage --> Context : Return data
Context --> Workflow : Provide context

== Conversation ==
Workflow -> Persona : Process conversation
Persona -> Context : Request context
Context --> Persona : Provide context
Persona --> Workflow : Response

== Free Notes Phase ==
Workflow -> Reflection : Update Free Notes
Reflection -> Context : Write (real-time)
Context -> Storage : Write
Storage --> Context : Confirm
Context --> Reflection : Confirm

== Reflections Phase ==
Workflow -> Reflection : Write Reflections
Reflection -> Context : Write
Context -> Storage : Write
Storage --> Context : Confirm
Context --> Reflection : Confirm

== Long-term Insights Phase ==
opt If significant insights exist
    Workflow -> Reflection : Write Long-term Insights
    Reflection -> Context : Write
    Context -> Storage : Write
    Storage --> Context : Confirm
    Context --> Reflection : Confirm
end

== Completion ==
Workflow --> UI : Complete
UI --> User : Show result

@enduml
